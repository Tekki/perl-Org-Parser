#!/usr/bin/perl

# a simple example script to dump org structure

# workaround for dzil
package dump_org_structure;

use 5.010;
use strict;
use warnings;
use Log::Any qw($log);

use String::Escape qw(elide printable);
use Org::Parser;

my $doc = Org::Parser->new->parse([<>]);
dump_element($doc);

sub dump_element {
    my ($el, $indent_level) = @_;
    $indent_level //= 0;

    print "  " x $indent_level;
    my $type = ref($el);
    $type =~ s/^Org::(Element|Document)(?:::|\z)//;
    print $type;
    if ($type eq 'Org::Element::Headline') {
        print " (level=".$el->level.")";
    }
    print ": ";
    my $content = printable elide($el->_raw // $el->as_string,
                                  80-2*$indent_level-length($type)-2);
    print "$content\n";

    if ($el->children) {
        dump_element($_, $indent_level+1) for @{ $el->children };
    }
}
